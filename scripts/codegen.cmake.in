cmake_minimum_required(VERSION 2.8)

foreach(path @PYTHONPATH@)
  if(WIN32)
    set(ENV{PYTHONPATH} "${path};$ENV{PYTHONPATH}")
  else()
    set(ENV{PYTHONPATH} "${path}:$ENV{PYTHONPATH}")
  endif()
endforeach()

if(CODEGEN_MODULE_NAME)
  list(APPEND ARGS --module=${CODEGEN_MODULE_NAME})
endif()
if(CODEGEN_IDL_FILE)
  list(APPEND ARGS --idl=${CODEGEN_IDL_FILE})
endif()
if(CODEGEN_API_FILE)
  list(APPEND ARGS --api=${CODEGEN_API_FILE})
endif()
if(CODEGEN_HEADER_FILE)
  list(APPEND ARGS --header=${CODEGEN_HEADER_FILE})
endif()
if(CODEGEN_SOURCE_FILE)
  list(APPEND ARGS --source=${CODEGEN_SOURCE_FILE})
endif()

execute_process(COMMAND @PYTHON_EXECUTABLE@
                @CMAKE_CURRENT_SOURCE_DIR@/codegen.py ${ARGS}
                ERROR_VARIABLE PYTHON_ERRORS OUTPUT_VARIABLE PYTHON_OUTPUT)

if(PYTHON_OUTPUT)
  message(${PYTHON_OUTPUT})
endif()
if(PYTHON_ERRORS)
  message(FATAL_ERROR ${PYTHON_ERRORS})
endif()
